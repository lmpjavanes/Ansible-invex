host,checked_at,status,message,package,version_installed,install_date,service_active,service_status,command_install,vendor,summary,description,files_copied,share_path,dest_dir
{% for hostres in (audit_windows | default([])) -%}
{%- set hstatus = hostres.status | default('ok') -%}
{%- if hstatus == 'unavailable' -%}
{{ hostres.host | default('') }},{{ hostres.checked_at | default('') }},unavailable,"{{ (hostres.message | default('Servidor no disponible') | string | trim | regex_replace('[\r\n]+',' ') | replace('"','""')) }}",,,,,,,,,,,,
{%- else -%}
{%- for pkg in (hostres.packages | default([])) -%}
{{ hostres.host | default('') }},{{ pkg.checked_at | default(hostres.checked_at | default('')) }},ok,,{{ pkg.package | default('') }},{{ pkg.version_installed | default('') }},{{ pkg.checked_at | default('') }},{{ pkg.service_active | default('') }},"{{ (pkg.service_status | default('') | string | trim | regex_replace('[\r\n]+',' ') | replace('"','""')) }}","{{ (pkg.command_install | default('') | string | trim | regex_replace('[\r\n]+',' ') | replace('"','""')) }}","{{ (pkg.vendor | default('') | string | trim | regex_replace('[\r\n]+',' ') | replace('"','""')) }}","{{ (pkg.summary | default('') | string | trim | regex_replace('[\r\n]+',' ') | replace('"','""')) }}","{{ (pkg.description | default('') | string | trim | regex_replace('[\r\n]+',' ') | replace('"','""')) }}","{{ (pkg.files_copied | default('') | string | trim | regex_replace('[\r\n]+',' ') | replace('"','""')) }}","{{ (pkg.share_path | default('') | string | trim | replace('"','""')) }}","{{ (pkg.dest_dir | default('') | string | trim | replace('"','""')) }}"
{%- endfor -%}
{%- endif -%}
{%- endfor -%}
