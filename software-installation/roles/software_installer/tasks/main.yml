---

- name: "Definir facts iniciales para el resultado"
  ansible.builtin.set_fact:
    software_installation_result:
      host: "{{ inventory_hostname }}"
      os_family: "{{ ansible_os_family | default('unknown') }}"
      overall_status: "pending"
      packages: []
      message: ""

- name: "Detectar hosts no disponibles"
  ansible.builtin.set_fact:
    host_unreachable: true
  when: ansible_os_family is not defined

- name: "Marcar como unreachable y finalizar si el host no esta disponible"
  ansible.builtin.set_fact:
    software_installation_result:
      host: "{{ inventory_hostname }}"
      os_family: "unknown"
      overall_status: "unreachable"
      packages: []
      message: "Host no alcanzable. No se pudo recopilar facts."
  when: host_unreachable | default(false)

- name: "Finalizar ejecucion para hosts no disponibles"
  ansible.builtin.meta: end_host
  when: host_unreachable | default(false)

- name: "Incluir tareas de instalacion para Linux"
  ansible.builtin.include_tasks: install_linux.yml
  when: ansible_os_family != "Windows"

- name: "Incluir tareas de instalacion para Windows"
  ansible.builtin.include_tasks: install_windows.yml
  when: ansible_os_family == "Windows"